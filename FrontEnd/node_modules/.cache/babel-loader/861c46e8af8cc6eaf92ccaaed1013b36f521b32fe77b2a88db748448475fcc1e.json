{"ast":null,"code":"const express = require(\"express\");\nconst route = express.Router();\nconst mongoose = require(\"mongoose\");\nconst multer = require(\"multer\");\nconst Product = require(\"../model/product\");\nmongoose.set(\"strictQuery\", false);\nmongoose.connect(\"mongodb+srv://vandy:khmergamer@cluster0.63zqaij.mongodb.net/User?retryWrites=true&w=majority\", {\n  useNewUrlParser: true,\n  useUnifiedTopology: true\n}).then(() => {\n  console.log(\"Connected to database\");\n}).catch(err => {\n  console.log(\"Error: \" + err);\n});\nconst storage = multer.diskStorage({\n  destination: function (req, file, cb) {\n    cb(null, \"C:/Ecommerce Project/frontend/public/Asset/Image/\");\n  },\n  filename: function (req, file, cb) {\n    cb(null, file.originalname);\n  }\n});\nconst fileFilter = (req, file, cb) => {\n  // Accept only image files\n  if (file.mimetype === \"image/jpeg\" || file.mimetype === \"image/png\") {\n    cb(null, true);\n  } else {\n    cb(null, false);\n  }\n};\nconst upload = multer({\n  storage: storage,\n  limits: {\n    fileSize: 1024 * 1024 * 5\n  },\n  fileFilter: fileFilter\n});\nroute.post(\"/addproduct\", upload.single(\"image\"), (req, res) => {\n  const product = new Product({\n    name: req.body.name,\n    description: req.body.description,\n    price: req.body.price,\n    stock: req.body.stock,\n    image: req.file.path\n  });\n  product.save().then(() => {\n    res.status(201).json({\n      message: \"Product added successfully\"\n    });\n  }).catch(error => {\n    res.status(500).json({\n      message: \"Adding product failed\",\n      error\n    });\n  });\n});\nroute.get(\"/allproduct\", (req, res) => {\n  Product.find().then(products => {\n    res.status(200).json(products);\n  }).catch(error => {\n    res.status(500).json({\n      message: \"Fetching products failed\",\n      error\n    });\n  });\n});\nmodule.exports = route;","map":{"version":3,"names":["express","require","route","Router","mongoose","multer","Product","set","connect","useNewUrlParser","useUnifiedTopology","then","console","log","catch","err","storage","diskStorage","destination","req","file","cb","filename","originalname","fileFilter","mimetype","upload","limits","fileSize","post","single","res","product","name","body","description","price","stock","image","path","save","status","json","message","error","get","find","products","module","exports"],"sources":["C:/Ecommerce Project/BackEnd/route/product.js"],"sourcesContent":["const express = require(\"express\");\r\nconst route = express.Router();\r\nconst mongoose = require(\"mongoose\");\r\nconst multer = require(\"multer\");\r\n\r\nconst Product = require(\"../model/product\");\r\n\r\nmongoose.set(\"strictQuery\", false);\r\n\r\nmongoose\r\n  .connect(\r\n    \"mongodb+srv://vandy:khmergamer@cluster0.63zqaij.mongodb.net/User?retryWrites=true&w=majority\",\r\n    { useNewUrlParser: true, useUnifiedTopology: true }\r\n  )\r\n  .then(() => {\r\n    console.log(\"Connected to database\");\r\n  })\r\n  .catch((err) => {\r\n    console.log(\"Error: \" + err);\r\n  });\r\n\r\nconst storage = multer.diskStorage({\r\n  destination: function (req, file, cb) {\r\n    cb(null, \"C:/Ecommerce Project/frontend/public/Asset/Image/\");\r\n  },\r\n  filename: function (req, file, cb) {\r\n    cb(null, file.originalname);\r\n  },\r\n});\r\n\r\nconst fileFilter = (req, file, cb) => {\r\n  // Accept only image files\r\n  if (file.mimetype === \"image/jpeg\" || file.mimetype === \"image/png\") {\r\n    cb(null, true);\r\n  } else {\r\n    cb(null, false);\r\n  }\r\n};\r\n\r\nconst upload = multer({\r\n  storage: storage,\r\n  limits: {\r\n    fileSize: 1024 * 1024 * 5,\r\n  },\r\n  fileFilter: fileFilter,\r\n});\r\n\r\nroute.post(\"/addproduct\", upload.single(\"image\"), (req, res) => {\r\n  const product = new Product({\r\n    name: req.body.name,\r\n    description: req.body.description,\r\n    price: req.body.price,\r\n    stock: req.body.stock,\r\n    image: req.file.path,\r\n  });\r\n\r\n  product\r\n    .save()\r\n    .then(() => {\r\n      res.status(201).json({ message: \"Product added successfully\" });\r\n    })\r\n    .catch((error) => {\r\n      res.status(500).json({ message: \"Adding product failed\", error });\r\n    });\r\n});\r\nroute.get(\"/allproduct\", (req, res) => {\r\n  Product.find()\r\n    .then((products) => {\r\n      res.status(200).json(products);\r\n    })\r\n    .catch((error) => {\r\n      res.status(500).json({ message: \"Fetching products failed\", error });\r\n    });\r\n});\r\n\r\nmodule.exports = route;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}